<div ng-if="vm.isViewHistory" class="modal-header">
    <h4 class="modal-title pull-left"> Call Notes History </h4>
    <a href="javascript:void(0);" ng-click="vm.close()" class="pull-right"><i class="fa fa-remove"></i></a>
</div>
<div ng-if="!vm.isViewHistory" class="modal-header">
    <h4 class="modal-title pull-left"> Phone Call Notes </h4>
    <a href="javascript:void(0);" ng-click="vm.close()" class="pull-right"><i class="fa fa-remove"></i></a>
</div>
<style>
    .modal-body.ng-scope {
        max-height: unset;
    }

    .modal-lg {
        width: 1500px !important;
    }

    html, body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
    }

    .container {
        border: 1px solid transparent;
        padding: 10px 10px 40px 10px;
        position: relative;
        margin: 0 auto 0 auto;
        height: 100%;
        margin-left: 0px !important;
    }

        .container .signature {
            border: 1px solid white;
            /*margin: 0 auto;*/
            cursor: pointer;
        }

            .container .signature canvas {
                border: 1px solid #999;
                /*margin: 0 auto;*/
                cursor: pointer;
            }

        .container .buttons {
            position: absolute;
            bottom: 10px;
            left: 10px;
        }

        .container .sizes {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }

            .container .sizes input {
                width: 4em;
                text-align: center;
            }

    .result {
        border: 1px solid blue;
        margin: 30px auto 0 auto;
        height: 220px;
        width: 568px;
    }

    .customScroll-s {
        width: 100%;
        float: left;
        height: 430px;
        overflow-y: scroll;
    }

        .customScroll-s::-webkit-scrollbar {
            width: 7px;
        }
        /* Track */
        .customScroll-s::-webkit-scrollbar-track {
            box-shadow: inset 0 0 5px grey;
            border-radius: 10px;
        }
        /* Handle */
        .customScroll-s::-webkit-scrollbar-thumb {
            background: #000;
            border-radius: 10px;
        }

    .header-align {
        vertical-align: middle !important;
    }
</style>
<div class="modal-body">
    <div ng-if="!vm.isViewHistory" class="col-md-12" style="border-color:black !important;" ng-style="{'max-width': boundingBox.width + 'px', 'max-height': boundingBox.height + 'px'}">
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Timestamp*</span>
            </div>
            <div class="col-md-6">
                <!--<input type="text" class="form-control" name="callerID" ng-disabled="true" ng-model="vm.currentTimestamp">-->
                <input type="text" class="form-control" name="callerID" ng-disabled="true" ng-model="vm.timestamp">
                <!--{{ clock | date:'HH:mm:ss'}}-->
            </div>
        </div>
        <br />
        <br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Caller ID*</span>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" name="callerID" ng-model="vm.callerId" maxlength="14">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Zip Code</span>
            </div>
            <div class="col-md-6">
                <input type="number" class="form-control" name="zipCode" ng-model="vm.zipCode" ng-keyup="vm.debouncedSearchZipCode(stateCollection)">
            </div>
            <div>
                <p style="color: #72b5e9">Wait for 3 seconds to load</p>
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Preferred Contact Number</span>
            </div>
            <div class="col-md-6">
                <input type="number" class="form-control" name="preferredContactNumber" ng-model="vm.preferredContactNumber" mask-format="phone">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Email</span>
            </div>
            <div class="col-md-6">
                <input type="email" class="form-control" name="email" ng-model="vm.email">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">First Name</span>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" name="firstName" ng-model="vm.firstName">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Last Name</span>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" name="lastName" ng-model="vm.lastName">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Company</span>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" name="company" ng-model="vm.company">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Office</span>
            </div>
            <div class="col-md-6">
                <select class="form-control" ng-model="vm.office"
                        ng-options="class.display as class.display for class in vm.officeCollection | orderBy : 'display'"
                        ng-change="vm.getClosedOffice()">
                    <option selected disabled hidden style='display: none' value=''>Select</option>
                </select>
            </div>
            <div>
                <p style="color:crimson">X prefix refers to all the closed offices</p>
            </div>
        </div><br /><br />

        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Resulting Action</span>
            </div>
            <div class="col-md-6">
                <select class="form-control" ng-model="vm.resultingAction"
                        ng-options="class.value as class.display for class in vm.resultingActionList | orderBy:'display':reverse" data-ng-required>
                    <option selected disabled hidden style='display: none' value=''>Select</option>
                </select>
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Address</span>
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding-right: 3.5px; display: inline-flex !important; margin-right: 2px; ">
            <div class="col-md-4">
                <span style="font-weight:bold;">Number</span>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" name="houseNumber" ng-model="vm.houseNumber">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding-right: 3.5px; display: inline-flex !important; margin-right: 2px; ">
            <div class="col-md-4">
                <span style="font-weight:bold;">Street</span>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" name="street" ng-model="vm.street">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding-right: 3.5px; display: inline-flex !important; margin-right: 2px; ">
            <div class="col-md-4">
                <span style="font-weight:bold;">City</span>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" name="city" ng-model="vm.city">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding-right: 3.5px; display: inline-flex !important; margin-right: 2px; ">
            <div class="col-md-4">
                <span style="font-weight:bold;">State</span>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" name="state" ng-model="vm.state">
            </div>
        </div><br /><br />
        <div class="col-md-12" style="padding-right: 3.5px; display: inline-flex !important; margin-right: 2px; ">
            <div class="col-md-4">
                <span style="font-weight:bold;">Country</span>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" name="country" ng-model="vm.country">
            </div>
        </div>
        <br />
        <br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <div class="col-md-4">
                <span style="font-weight:bold;">Notes*</span>
            </div>
            <div class="col-md-6">
                <textarea rows="8" type="text" class="form-control" name="callDetailsNotes" ng-model="vm.callDetailsNotes" maxlength="5000"></textarea>
            </div>
        </div>
        <br />
        <br />
        <div class="col-md-12" style="padding: 0 0px; display: inline-flex !important; margin-right: 2px;">
            <b>Note: </b><i>The character limit for Phone Call Notes is 5000.</i>
        </div>
    </div>

    <!--Phone Call Notes-->

    <div ng-if="vm.isViewHistory" class="dataTables_length pull-left m-t-35 showing-record" id="sample_1_length">
        <label>
            Show
            <select name="sample_1_length" aria-controls="sample_1" class="form-control input-xsmall input-inline"
                    ng-model="vm.query.pageSize" ng-options="option.value as option.display for option in vm.pagingOptions"
                    ng-change="vm.getCallDetailNotes();">
                <option selected disabled hidden style='display: none' value=''></option>
            </select> records
        </label>
    </div>
    <div class="clearfix" ng-if="vm.isViewHistory">
        <div class="pull-left" style="position:absolute">
            <div class="dataTables_info" id="sample_1_info" role="status" aria-live="polite" ng-if="vm.notesList.length > 0">
                Showing
                <span ng-if="(vm.query.pageNumber * vm.query.pageSize) <= vm.count">{{((vm.query.pageNumber - 1) * vm.query.pageSize)+ 1}} to {{vm.query.pageNumber * vm.query.pageSize}} of {{vm.count}} </span>
                <span ng-if="(vm.query.pageNumber * vm.query.pageSize) > vm.count">{{((vm.query.pageNumber - 1) * vm.query.pageSize)+ 1}} to {{vm.count}} of {{vm.count}} </span>
                records
            </div>
        </div>
        <div class="pull-right" ng-if="vm.notesList.length < vm.count">
            <div class="dataTables_paginate paging_bootstrap_full_number" id="sample_1_paginate">
                <ul uib-pagination boundary-links="true" total-items="vm.count" ng-change="vm.pageChange()" items-per-page="vm.query.pageSize"
                    ng-model="vm.query.pageNumber" class="pagination-sm" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" max-size="'5'"
                    last-text="&raquo;"></ul>
            </div>
        </div>
    </div>

    <div ng-if="vm.isViewHistory" class="col-md-3" style="margin-top: 30px !important; margin-left:0px !important; padding: 0 !important">
        <span title="Invoice In Queue"><b>Note: <i class="fa fa-file" aria-hidden="true"></i> :- This Note Is Edited.</b></span>
    </div>

    <div class=" col-md-7 pull-right search-btn-wrap" style="margin-left: 0 !important;" ng-if="vm.isViewHistory">
        <div class="search-box">
            <div class="pull-right search-single" ng-show="vm.isViewHistory">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <select class="form-control input-small" id="search-option" ng-model="vm.searchOption"
                            ng-change="vm.resetSeachOption()"
                            ng-options="item.value as item.display for item in vm.searchOptions">
                        <option selected disabled hidden style='display: none' value=''></option>
                    </select>
                    <label for="search-option">Search Options</label>
                </div>
            </div>
            <div class="search-single pull-right" ng-if="vm.searchOption == '1'">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <input type="search" class="form-control input-sm" style="margin-top: -6px;" placeholder="" aria-controls="sample_1"
                           ng-model="vm.query.callerId" key-stroke-action change="vm.getCallDetailNotes" maxlength="14">
                    <label>Search</label>
                </div>
            </div>
            <div class="pull-right search-single" ng-if="vm.searchOption == '2'">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <input type="search" class="form-control input-sm" style="margin-top: -6px;" placeholder="" aria-controls="sample_1"
                           ng-model="vm.queryLeadFlow.text" key-stroke-action change="vm.getLeadFlowDetails">
                    <label>Search</label>
                </div>
            </div>
            <div class="pull-right search-single" ng-if="vm.searchOption == '3'">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <select class="form-control input-small" id="franchisee" ng-model="vm.query.office"
                            ng-change="vm.getCallDetailNotes()"
                            ng-options="office.value as office.display for office in vm.officeCollection | orderBy: 'display'">
                        <option selected disabled hidden style='display: none' value=''></option>
                    </select>
                    <label for="franchisee">Office</label>
                </div>
            </div>
            <div class="pull-right search-single" ng-if="vm.query.office != null">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <select class="form-control input-small" id="franchisee" ng-model="vm.query.resultingAction"
                            ng-change="vm.getCallDetailNotes()"
                            ng-options="resultingAction.value as resultingAction.display for resultingAction in vm.resultingActionList">
                        <option selected disabled hidden style='display: none' value=''></option>
                    </select>
                    <label for="franchisee">Resulting Action</label>
                </div>
            </div>
            <div class="pull-right search-single">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <input type="text" class="form-control" id="date-range" date-range-picker change="vm.getCallDetailNotes"
                           start-date="vm.query.startDate" end-date="vm.query.endDate">
                    <label for="date-range">Date Range</label>
                </div>
            </div>
            <div class="pull-right search-single">
                <div class="form-group form-md-line-input">
                    <a class="btn btn-icon-only mbl" ng-click="vm.resetSearch();">
                        <i class="fa fa-remove"></i>
                    </a>
                </div>
            </div>
            <div class="pull-right search-single">
                <div class="form-group form-md-line-input">
                    <a class="btn btn-icon-only mbl" ng-click="vm.refresh();">
                        <i class="fa fa-refresh"></i>
                    </a>
                </div>
            </div>
            <div class="pull-right search-single">
                <div class="form-group form-md-line-input">
                    <button title="Download File" id="sample_editable_1_new" class="btn-icon-only mbl" style="margin-right: 2px; margin-top: -2px !important; background: none; border: none;" ng-click="vm.downloadCallNotesHistory()">
                        <img src="/Content/images/downloadIcon.png" />
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="vm.isViewHistory" class="row">
        <div class="col-md-12" style="overflow: auto; max-height: 70vh;">
            <table class="table table-hover table-striped table-bordered dataTable no-footer" style="margin-top:0px !important" id="sample_1" role="grid" aria-describedby="sample_1_info">
                <thead>
                    <tr style="position: sticky; top: 0; background-color: white;">
                        <td style="font-weight:bolder; width:5% !important">
                            ID#
                        </td>
                        <td style="font-weight: bolder; width: 12% !important;">
                            Added On
                        </td>
                        <td style="font-weight:bolder; width:8% !important">
                            Caller ID
                        </td>
                        <td style="font-weight: bolder; width: 10% !important;">
                            Added By
                        </td>
                        <td style="font-weight: bolder; width: 5% !important;">
                            Call Matched
                        </td>
                        <td style="font-weight: bolder; width: 5% !important;">
                            Role
                        </td>
                        <td style="font-weight: bolder; width: 10% !important;">
                            Office
                        </td>
                        <td style="font-weight: bolder; width: 10% !important;">
                            Resulting Action
                        </td>
                        <td style="font-weight: bolder; width: 45% !important">
                            Note
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-if="vm.notesList.length>0" ng-repeat-start="item in vm.notesList">
                        <td style="word-break: break-word !important; width: 5% !important;">
                            <span ng-if="item.callMatched">
                                {{item.callId}}
                            </span>
                            <span ng-if="!item.callMatched">

                            </span>
                        </td>
                        <td style="word-break: break-word !important; width: 12% !important;">
                            {{item.createdOn | date:'MM/dd/yyyy h:mm:ssa'}}
                        </td>
                        <td style="word-break: break-word !important; width: 8% !important;">
                            {{item.callerId  | phonemask}}
                        </td>
                        <td style="width: 10% !important;">
                            {{item.createdBy}}
                        </td>
                        <td style="width: 5% !important">
                            <span ng-if="item.callMatched">
                                <a ng-click="vm.rowDetail(item.marketingLeadId, item)">Yes</a>
                            </span>
                            <span ng-if="!item.callMatched">
                                No
                            </span>
                        </td>
                        <td style="width: 5% !important;">
                            {{item.userRole}}
                        </td>
                        <td style="word-break: break-word !important; width: 10% !important;">
                            {{item.office}}
                        </td>
                        <td style="word-break: break-word !important; width: 10% !important;">
                            {{item.resultingAction}}
                        </td>
                        <td style="word-break: break-word !important; width: 45% !important; ">
                            <span ng-if="item.isEdited == true" class="pull-left" title="Note Edited">
                                <b><i class="fa fa-file" aria-hidden="true"></i></b>&nbsp;
                            </span>
                            <span>
                                {{item.callNote}}
                            </span>
                            <span class="pull-right">
                                <a class="input-group-text fa fa-pencil" title="Edit Call Note" ng-click="vm.editCallNote(item)"></a>
                            </span>
                        </td>
                    </tr>
                    <tr class="ng-scope" ng-if="item.isExpend">
                        <td colspan="9">
                            <table class="table table-striped table-bordered" id="sample_1" role="grid" aria-describedby="sample_1_info">
                                <thead style="background-color: #a7f5a7;">
                                    <tr role="row">
                                        <td style="border-bottom: 0; border-right: none; width: 2px !important; min-width: 2px !important; max-width: 2px !important;">
                                            <i class="fa fa-minus-circle icon-red" style="cursor:pointer" ng-click="vm.collapseRow(item)"></i>
                                        </td>
                                        <th class="header-align">
                                            ID#
                                        </th>
                                        <th class="header-align">
                                            Date/Time Of Call
                                        </th>
                                        <th class="header-align">
                                            Dialed Number (dnis)
                                        </th>
                                        <th class="header-align">
                                            Caller ID (ani)
                                        </th>
                                        <th class="header-align">
                                            Transfer To Number
                                        </th>
                                        <th class="header-align">
                                            Phone Label
                                        </th>
                                        <th class="header-align">
                                            Ring Seconds
                                        </th>
                                        <th class="header-align">
                                            Ring Count
                                        </th>
                                        <th class="header-align">
                                            Recorded Seconds
                                        </th>
                                        <th class="header-align">
                                            Call Duration
                                        </th>
                                        <th class="header-align">
                                            Call Route(Mapped By ZipCode)
                                        </th>
                                        <th class="header-align">
                                            Franchisee(Invoca API)
                                        </th>
                                        <th class="header-align" style="width: 65px !important; min-width: 65px !important; max-width: 65px !important">
                                            Call Flow Entered Zip
                                        </th>
                                        <!--<th>
                                            Call Note
                                        </th>-->
                                        <th class="header-align">
                                            Preferred Contact Number
                                        </th>
                                        <th class="header-align">
                                            Email
                                        </th>
                                        <th class="header-align">
                                            First Name
                                        </th>
                                        <th class="header-align">
                                            Last Name
                                        </th>
                                        <th class="header-align">
                                            Company
                                        </th>
                                        <th class="header-align">
                                            Zip Code
                                        </th>
                                        <th class="header-align">
                                            Number
                                        </th>
                                        <th class="header-align">
                                            Street
                                        </th>
                                        <th class="header-align">
                                            City
                                        </th>
                                        <th class="header-align">
                                            State
                                        </th>
                                        <th class="header-align">
                                            Country
                                        </th>
                                        <th class="header-align">
                                            Transcription Status
                                        </th>
                                        <th class="header-align">
                                            Missed Call
                                        </th>
                                        <th class="header-align">
                                            Find Me List
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="item in vm.callDetailList">
                                        <td style="border-right: none; width: 2px !important; min-width: 2px !important; max-width: 2px !important; "></td>
                                        <td>{{item.id}}</td>
                                        <td>
                                            <span ng-if="item.dataFromInvoca=='Yes'">{{item.dateOfCall | date:'MM/dd/yyyy hh:mm a'}}</span>
                                            <span ng-if="item.dataFromInvoca=='No'">{{item.dateOfCall | dateTimeFilter: 'udt'}}</span>
                                        </td>
                                        <td>{{item.dnis | phonemask}}</td>
                                        <td>{{item.ani | phonemask}}</td>
                                        <td>{{item.transferToNumber | phonemask}}</td>
                                        <td>{{item.phoneLabel}}</td>
                                        <td>
                                            {{item.ringSeconds_CallFlow}}
                                        </td>
                                        <td>
                                            {{item.ringCount_CallFlow}}
                                        </td>
                                        <td>
                                            {{item.recordedSeconds_Recording}}
                                        </td>
                                        <td>{{item.callDuration}} min.</td>
                                        <td>{{item.callRoute}}</td>
                                        <td>{{item.franchisee}}</td>
                                        <td style="width: 65px !important; min-width: 65px !important; max-width: 65px !important">
                                            {{item.callFlowEnteredZip}}
                                        </td>
                                        <!--<td>
                                            <span style="word-break:break-all;">
                                                {{item.callNote | limitTo: 50}}{{item.callNote.length > 50 ? '......' : ''}}
                                                <a href="javascript:void(0);" ng-click="vm.getNotes(item.callNote, item.ani)" ng-if="item.callNote.length > 50">View More</a>
                                            </span>
                                        </td>-->
                                        <td>
                                            <span ng-if="item.preferredContactNumber != null && item.preferredContactNumber > 0">
                                                {{item.preferredContactNumber}}
                                            </span>
                                        </td>
                                        <td>
                                            {{item.email}}
                                        </td>
                                        <td>
                                            {{item.firstName}}
                                        </td>
                                        <td>
                                            {{item.lastName}}
                                        </td>
                                        <td>
                                            {{item.company}}
                                        </td>
                                        <td>
                                            {{item.zipCode}}
                                        </td>
                                        <td>
                                            {{item.houseNumber}}
                                        </td>
                                        <td>
                                            {{item.street}}
                                        </td>
                                        <td>
                                            {{item.city}}
                                        </td>
                                        <td>
                                            {{item.state}}
                                        </td>
                                        <td>
                                            {{item.country}}
                                        </td>
                                        <td>
                                            {{item.transcriptionStatus_CallAnalytics}}
                                        </td>
                                        <td>
                                            {{item.missedCall_CallMetrics}}
                                        </td>
                                        <td>
                                            {{item.findMeList}}
                                        </td>
                                    </tr>
                                </tbody>
                                <tr ng-if="vm.callDetailList.length == 0">
                                    <td colspan="12" class="text-center"><span> No Records Found</span></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr ng-if="item.isExpend" ng-repeat-end=""></tr>
                    <tr ng-if="vm.notesList.length==0">
                        <td colspan="9">
                            <b>No Records Found</b>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="modal-footer">
    <button class="btn btn-primary" ng-if="!vm.isViewHistory && !vm.isEditing" ng-click="vm.save()">Save</button>
    <button class="btn" ng-if="!vm.isViewHistory && !vm.isEditing" ng-click="vm.close()">Close</button>
    <button class="btn btn-primary" ng-if="!vm.isViewHistory && vm.isEditing" ng-click="vm.edit()">Edit</button>
    <button class="btn" ng-if="!vm.isViewHistory && vm.isEditing" ng-click="vm.cancel()">Cancel</button>
</div>
